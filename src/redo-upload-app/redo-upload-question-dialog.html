<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/iron-input/iron-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner-lite.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">

<link rel="import" href="shared-styles.html">

<dom-module id="redo-upload-question-dialog">
	<template>
		<style include="shared-styles">
			:host(:not([opened])) .background{
				display: none;
			}
			:host([opened]) .background{
				display: flex;
			}
			paper-dialog{
				width: 600px;
				padding: 20px;
				position: relative;
			}
			i.close{
				position: absolute;
				top: 0;
				right: 0;
				cursor: pointer;
			}
			.background{
				position: fixed;
				width: 100%;
				height: 100%;
				background: rgba(0,0,0,0.2);
				align-items: center;
				justify-content: center;
				top: 0;
				left: 0;
			}
			.question{
				display: flex;
				justify-content: stretch;
				align-items: center;
			}
			.question .description{
				flex: 2;
			}
			.index{
				padding: 5px 10px;
				text-align: center;
				background: var(--redo-transparent-red-background-color);
				border-radius: 3px;
				margin-right: 5px;
			}
			paper-button{
				width: 100%;
				margin:10px auto;
			}
			h2{
				font-weight: normal;
				font-size: 20px;
				color: darkgray;
			}
		</style>
		<div class="background">
			<paper-dialog opened="{{opened}}">
				<i class="material-icons close" on-click="_toggle">close
					<paper-ripple></paper-ripple>
				</i>
				<h2>[[title]]</h2>
				<div class="field">
					<label>Descripción:</label>
					<textarea id="description" rows="10" on-input="_descriptionChanged"></textarea>
				</div>
				<div class="field">
					<label>Imagen:</label>
					<div class="img-upload" style="">
						<div class="img-mask">
							<i class="material-icons">insert_photo</i>
							<label>Cargar imagen</label>
						</div>
						<input type="file" on-input="_imageUpload">
					</div>
				</div>
				<div class="question">
					<div class="index">A</div>
					<iron-input bind-value="{{question.answers.a}}"><input type="text"></iron-input>
				</div>
				<div class="question">
					<div class="index">B</div>
					<iron-input bind-value="{{question.answers.b}}"><input type="text"></iron-input>
				</div>
				<div class="question">
					<div class="index">C</div>
					<iron-input bind-value="{{question.answers.c}}"><input type="text"></iron-input>
				</div>
				<div class="question">
					<div class="index">D</div>
					<iron-input bind-value="{{question.answers.d}}"><input type="text"></iron-input>
				</div>
				<div class="field">
					<label>Elige la respuesta correcta:</label>
					<paper-radio-group selected="{{question.selectedAnswer}}">
						<paper-radio-button name="a">A</paper-radio-button>
						<paper-radio-button name="b">B</paper-radio-button>
						<paper-radio-button name="c">C</paper-radio-button>
						<paper-radio-button name="d">D</paper-radio-button>
					</paper-radio-group>
				</div>
				<div class="field">
					<label>Bibliografía:</label>
					<iron-input bind-value="{{question.bibliography}}"><input type="text"></iron-input>
				</div>
				<paper-button on-click="_saveQuestion"><i class="material-icons">save</i>Guardar</paper-button>
				
				
			</paper-dialog>
		</div>
		<iron-ajax
			id="saveQuestionAjax"
			method="POST"
			url="https://www.ficus.com.mx/redo/saveQuestion.php"
			content-type="application/json"
			body="[[question]]"
			on-response="_handleSaveQuestionResponse"
			on-error="_handleSaveQuestionError"></iron-ajax>
		

	</template>
	<script>
		class RedoUploadQuestionDialog extends Polymer.Element{
			static get is() { return 'redo-upload-question-dialog' }

			static get properties(){
				return{
					question:{
						type: Object,
					},
					opened:{
						type: Boolean,
						value: false,
						reflectToAttribute: true,
					},
					loadingAnswer:{
						type: Boolean,
						value: false
					},
					title:{
						type: String,
						value: "Nueva Pregunta"
					}
				}
			}

			open(){
				this.question = {}
				this.title = "Nueva Pregunta"
				this.opened = true
			}

			_toggle(){
				this.opened = !this.opened
			}

			_openWithQuestion(question){
				if (question) {
					this.title = "Editar Pregunta"
					this.set('question', question)
					this.opened = true
				}else{
					this.open()
				}
			}

			_handleSaveQuestionResponse(r){
				if (r.detail.response.success) {
					//alert success
				}else{
					//alert error
				}
			}

			_handleSaveQuestionError(e){
				//alert error
			}

			_descriptionChanged(e){
				this.set('question.description', e.target.value)
			}

			_saveQuestion(){
				//just for reviewing purposes
				console.log(this.question)
				//this.$.saveQuestionAjax.generateRequest()
			}

			_imageUpload(e){
				console.log(e)
			}

		}

		customElements.define(RedoUploadQuestionDialog.is, RedoUploadQuestionDialog)
	</script>
</dom-module>